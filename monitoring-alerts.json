{
  "alerts": {
    "critical": [
      {
        "name": "Payment System Down",
        "condition": "All payment initiations failing",
        "threshold": "100% error rate for 5+ minutes",
        "action": "Immediate investigation required",
        "checks": [
          "Verify Cashfree API status",
          "Check environment variables",
          "Review recent deployments",
          "Check Firebase Admin SDK connection"
        ]
      },
      {
        "name": "Webhook Failures",
        "condition": "Webhooks not being received or processed",
        "threshold": "No webhooks received for 1+ hour with active payments",
        "action": "Immediate investigation required",
        "checks": [
          "Verify webhook URL in Cashfree dashboard",
          "Check webhook signature verification",
          "Review webhook endpoint logs",
          "Test webhook endpoint manually"
        ]
      },
      {
        "name": "Database Connection Failure",
        "condition": "Firestore operations failing",
        "threshold": "Multiple consecutive failures",
        "action": "Immediate investigation required",
        "checks": [
          "Check Firebase project status",
          "Verify service account credentials",
          "Check Firestore security rules",
          "Review network connectivity"
        ]
      },
      {
        "name": "Expiry Function Not Running",
        "condition": "Scheduled function hasn't executed",
        "threshold": "No execution for 25+ hours",
        "action": "Investigate within 2 hours",
        "checks": [
          "Check Firebase Functions logs",
          "Verify function deployment",
          "Check function schedule configuration",
          "Manually trigger function for testing"
        ]
      }
    ],
    "warning": [
      {
        "name": "High Error Rate",
        "condition": "Elevated error rate on payment APIs",
        "threshold": ">5% error rate over 15 minutes",
        "action": "Monitor closely, investigate if persists",
        "checks": [
          "Review error logs for patterns",
          "Check for specific error types",
          "Monitor user reports",
          "Review recent code changes"
        ]
      },
      {
        "name": "Slow Response Times",
        "condition": "API response times elevated",
        "threshold": ">3s average response time",
        "action": "Investigate performance issues",
        "checks": [
          "Check function cold starts",
          "Review database query performance",
          "Check external API latency (Cashfree)",
          "Review function memory allocation"
        ]
      },
      {
        "name": "Unusual Payment Patterns",
        "condition": "Spike in payment failures or cancellations",
        "threshold": ">20% failure rate",
        "action": "Review user experience and payment flow",
        "checks": [
          "Check Cashfree dashboard for issues",
          "Review user feedback",
          "Test payment flow manually",
          "Check for UI/UX issues"
        ]
      },
      {
        "name": "Webhook Processing Delays",
        "condition": "Webhooks taking longer than expected",
        "threshold": ">5s processing time",
        "action": "Optimize webhook handler",
        "checks": [
          "Review webhook handler code",
          "Check database write performance",
          "Monitor concurrent webhook processing",
          "Consider async processing"
        ]
      }
    ],
    "info": [
      {
        "name": "Daily Payment Summary",
        "condition": "Daily report of payment activity",
        "frequency": "Daily at 9:00 AM",
        "includes": [
          "Total payments processed",
          "Success rate",
          "Revenue by plan type",
          "Campaigns expired",
          "Campaigns reactivated"
        ]
      },
      {
        "name": "Weekly Performance Report",
        "condition": "Weekly system performance summary",
        "frequency": "Monday at 9:00 AM",
        "includes": [
          "Payment trends",
          "Popular plans",
          "User growth",
          "System health metrics",
          "Error summary"
        ]
      }
    ]
  },
  "monitoring_endpoints": {
    "vercel": {
      "logs": "vercel logs --follow",
      "errors": "vercel logs --filter=error --limit=50",
      "payment_api": "vercel logs --filter=api/payments --limit=50"
    },
    "firebase": {
      "function_logs": "firebase functions:log --only scheduledCampaignExpiryCheck",
      "all_logs": "firebase functions:log"
    },
    "health_check": {
      "script": "./scripts/check-system-health.sh",
      "frequency": "Every hour"
    }
  },
  "notification_channels": {
    "email": {
      "enabled": true,
      "recipients": ["admin@phrames.com"],
      "alerts": ["critical", "warning"]
    },
    "slack": {
      "enabled": false,
      "webhook_url": "https://hooks.slack.com/services/YOUR/WEBHOOK/URL",
      "alerts": ["critical"]
    },
    "sms": {
      "enabled": false,
      "alerts": ["critical"]
    }
  },
  "metrics_to_track": {
    "payment_metrics": [
      "payment_initiation_count",
      "payment_success_count",
      "payment_failure_count",
      "payment_success_rate",
      "average_payment_amount",
      "revenue_by_plan_type"
    ],
    "performance_metrics": [
      "api_response_time_p50",
      "api_response_time_p95",
      "api_response_time_p99",
      "webhook_processing_time",
      "function_execution_time",
      "error_rate"
    ],
    "campaign_metrics": [
      "active_campaigns_count",
      "expired_campaigns_today",
      "campaigns_activated_today",
      "campaigns_reactivated_today"
    ],
    "system_metrics": [
      "function_invocations",
      "function_errors",
      "database_reads",
      "database_writes"
    ]
  },
  "log_retention": {
    "vercel": "30 days (Pro plan)",
    "firebase": "30 days (default)",
    "firestore_logs": "90 days (custom collection)"
  },
  "escalation_policy": {
    "critical": {
      "immediate": "Notify on-call engineer",
      "15_minutes": "Escalate to senior engineer",
      "30_minutes": "Escalate to engineering manager"
    },
    "warning": {
      "immediate": "Log and monitor",
      "1_hour": "Notify engineering team",
      "4_hours": "Create incident ticket"
    }
  }
}
